let u=null,l=null,c=null,d=null,i=null,g=!1;function y(e){return{width:e.width,height:e.height,depth:8,data:e.data}}function j(e){const t=e.data,n=new ArrayBuffer(t.byteLength),o=new Uint8ClampedArray(n);return o.set(t),new ImageData(o,e.width,e.height)}async function b(){if(g)return;const e=await import("./chunks/V1TnyLgC.js");u=e.jpeg,l=e.png,c=e.webp,d=e.avif,i=e.jxl,await Promise.all([u.loadEncoder(),u.loadDecoder(),l.loadEncoder(),l.loadDecoder(),c.loadEncoder(),c.loadDecoder(),d.loadEncoder(),d.loadDecoder(),i.loadEncoder(),i.loadDecoder()]),g=!0}function C(e,t){const n=new Uint8Array(e);switch(t){case"jpeg":return u.decode(n);case"png":return j(l.decode(n));case"webp":return c.decode(n);case"avif":return d.decode(n);case"jxl":return i.decode(n);default:throw new Error(`Cannot decode format in worker: ${t}`)}}function v(e,t,n,o){const r=y(e);switch(t){case"jpeg":return u.encode(r,{quality:o?100:n});case"png":return l.encode(r,{level:o?4:3,quantize:!o});case"webp":return o?c.encode(r,{lossless:!0}):c.encode(r,{quality:n});case"avif":return o?d.encode(r,{quality:100,speed:4}):d.encode(r,{quality:n,speed:6});case"jxl":return o?i.encode(r,{lossless:!0}):i.encode(r,{quality:n});default:throw new Error(`Unsupported output format: ${t}`)}}function E(e){return{jpeg:"image/jpeg",png:"image/png",webp:"image/webp",avif:"image/avif",jxl:"image/jxl",svg:"image/svg+xml"}[e]}function p(e,t){const n={id:e,success:!0,progress:t};self.postMessage(n)}async function x(e){const{id:t,imageBuffer:n,inputFormat:o,outputFormat:r,quality:w,lossless:m}=e;try{await b(),p(t,20);const s=C(n,o);p(t,50);const a=v(s,r,w,m);p(t,90);const f=a.buffer.slice(a.byteOffset,a.byteOffset+a.byteLength),h={id:t,success:!0,result:f,mimeType:E(r),width:s.width,height:s.height};self.postMessage(h,[f])}catch(s){const a={id:t,success:!1,error:s instanceof Error?s.message:"Compression failed"};self.postMessage(a)}}self.onmessage=async e=>{const t=e.data;t.type==="compress"&&await x(t)};self.postMessage({type:"ready"});
